{% extends "ballot_entry_base.html" %}
{% load debate_tags i18n %}

{% block head-title %}<!-- Pass title to Vue instead -->{% endblock %}

{% block page-alerts %}

  {% if new %}
    {% if user_role == "admin" %}
      {% tournamenturl 'old-results-ballotset-new' debate_id=debate.id as old_url %}
    {% else %}
      {% tournamenturl 'old-results-assistant-ballotset-new' debate_id=debate.id as old_url %}
    {% endif %}
  {% else %}
    {% if user_role == "admin" %}
      {% tournamenturl 'old-results-ballotset-edit' pk=ballotsub.id as old_url %}
    {% else %}
      {% tournamenturl 'old-results-assistant-ballotset-edit' pk=ballotsub.id as old_url %}
    {% endif %}
  {% endif %}
  {% blocktrans trimmed asvar message %}
    This ballot entry interface is in beta, if you encounter any problems you can use the older
    version of the interface by <a href="{{ old_url }}" class="alert-link">following this link</a>.
  {% endblocktrans %}
  {% include "components/alert.html" with type="info" %}
  {{ block.super }}

{% endblock %}

{% block content %}

  <div id="vueMount">
    <ballot-entry-container
      :debate-name="'{{ debate_name|safe }}'"
      :debate-venue="'{{ debate.venue }}'" :debate-round="'{{ debate.round.name }}'"
      :is-new="{% if new %}true{% else %}false{% endif %}"
      :send-receipts=" {% if pref.enable_ballot_receipts %}true{% else %}false{% endif %}"
      :author="'{{ request.user|safe }}'" :ballot-author="'{{ ballotsub.submitter|safe }}'">
    </ballot-entry-container>
  </div>

  <form id="resultsForm" action="." method="POST">

    {% csrf_token %}

    {% if form.errors %}
      {% trans "There are some problems with this scoresheet. Please review and correct them." as message %}
      {% include "components/form-errors.html" with errors=form.non_field_errors %}
    {% endif %}

    <div id="ballot"><!-- Parsed by Vue for data and as a mirror input -->
      {% include "ballot_entry_form.html" %}
    </div>

  </form>

{% endblock content %}

{% block js %}
  <script>
    window.vueData = {
    }
  </script>
  {{ block.super }}
{% endblock js %}
