{% load i18n team_name_for_data_entry %}

{% block content %}

  {% for sheet in form.scoresheets %}

    {% if sheet.adjudicator %}
      {% if sheet.adjudicator.institution %}
        {% blocktrans trimmed with name=sheet.adjudicator.name institution=sheet.adjudicator.institution.code asvar title %}
          Ballot from {{ name }} ({{ institution }})
        {% endblocktrans %}
      {% else %}
        {% blocktrans trimmed with name=sheet.adjudicator.name asvar title %}
          Ballot from {{ name }}
        {% endblocktrans %}
      {% endif %}
      {% if sheet.adjudicator == debate.adjudicators.chair %}
        {% blocktrans trimmed asvar subtitle %}Chair{% endblocktrans %}
      {% elif sheet.adjudicator != debate.adjudicators.chair %}
        {% blocktrans trimmed asvar subtitle %}Panellist{% endblocktrans %}
      {% endif %}
    {% else %}
      {% if debate.adjudicators.has_chair %}
        {% blocktrans trimmed with chair=debate.adjudicators.chair asvar title %}
          Scoresheet from chair {{ chair }}
        {% endblocktrans %}
      {% else %}
        {% blocktrans trimmed asvar title %}
          Scoresheet, no chair set
        {% endblocktrans %}
      {% endif %}
    {% endif %}

    <div data-type="sheet" data-id="" data-title="{{ title }}" data-subtitle="{{ subtitle }}">

      {% for team in sheet.teams %}
        <div data-type="team" data-id="{{ team.team.id }}" data-side="{{ team.side_code }}"
              data-name="{% team_name_for_data_entry team.team use_team_code_names %}">
          {% for position in team.speakers %}

            <div data-type="speaker" data-position="{{ position.name }}" hidden>
              {{ position.speaker }}
              {{ position.ghost }}
              {{ position.ghost.label_tag }}
              {{ position.score }}
            </div>

            {% for error in position.speaker.errors %}
              {% blocktrans asvar message with pos=position.name error=error %}
                Error with {{ pos }}'s speaker field: {{ error }}
              {% endblocktrans %}
              {% include "components/form-errors.html" %}
            {% endfor %}
            {% for error in position.ghost.errors %}
              {% blocktrans asvar message with pos=position.name error=error %}
                Error with {{ pos }}'s duplicate speaker field: {{ error }}
              {% endblocktrans %}
              {% include "components/form-errors.html" %}
            {% endfor %}
            {% for error in position.score.errors %}
              {% blocktrans asvar message with pos=position.name error=error %}
                Error with {{ pos }}'s score field: {{ error }}
              {% endblocktrans %}
              {% include "components/form-errors.html" %}
            {% endfor %}

          {% endfor %}
        </div>
      {% endfor %}
    </div>

  {% endfor %}

  {% if new and not pref.disable_ballot_confirms %}
    {# After a new ballot, always go into DRAFT, and the new ballot is neither discarded nor confirmed. #}
    <input hidden id="id_debate_result_status" name="debate_result_status" value="{{ debate.STATUS_DRAFT }}" />
    <input hidden id="id_confirmed" name="confirmed" value="False" />
  {% else %}
    <input hidden id="id_debate_result_status" name="debate_result_status" value="{{ debate.STATUS_CONFIRMED }}" />
    <input hidden id="id_confirmed" name="confirmed" value="True" />
  {% endif %}
  <input hidden id="id_discarded" name="discarded" value="False" />

{% endblock content %}
